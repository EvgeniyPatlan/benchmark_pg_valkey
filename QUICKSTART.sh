#!/bin/bash
# QUICK START - Queue Benchmark Framework
# Copy and paste these commands to get started quickly

echo "==================================================="
echo "Queue Benchmark Framework - Quick Start"
echo "==================================================="
echo ""

# Extract
echo "Step 1: Extract archive"
echo "tar -xzf queue-benchmark-complete.tar.gz"
echo "cd queue-benchmark"
echo ""

# VM1 - PostgreSQL
echo "Step 2a: VM1 (PostgreSQL) - Run these commands:"
echo ""
echo "sudo ./setup/install_pg.sh"
echo "pip3 install -r setup/requirements.txt"
echo ""
echo "# Set up authentication"
echo "cat > ~/.pgpass << 'EOF'"
echo "localhost:5432:bench_db:bench_user:bench_pass"
echo "EOF"
echo "chmod 600 ~/.pgpass"
echo ""
echo "# Initialize schemas"
echo "PGPASSWORD=bench_pass psql -h localhost -U bench_user -d bench_db -f schema/pg_queue_basic.sql"
echo "PGPASSWORD=bench_pass psql -h localhost -U bench_user -d bench_db -f schema/pg_queue_delete_returning.sql"
echo "PGPASSWORD=bench_pass psql -h localhost -U bench_user -d bench_db -f schema/pg_queue_partitioned.sql"
echo "PGPASSWORD=bench_pass pgbench -h localhost -U bench_user -d bench_db -i -s 10"
echo ""
echo "# Run benchmarks"
echo "export PGPASSWORD=bench_pass"
echo "./orchestration/run_pg_tests.sh"
echo ""
echo "==================================================="
echo ""

# VM2 - Valkey
echo "Step 2b: VM2 (Valkey) - Run these commands:"
echo ""
echo "sudo ./setup/install_pg.sh"
echo "sudo ./setup/install_valkey.sh"
echo "pip3 install -r setup/requirements.txt"
echo ""
echo "# Set up authentication"
echo "cat > ~/.pgpass << 'EOF'"
echo "localhost:5432:bench_db:bench_user:bench_pass"
echo "EOF"
echo "chmod 600 ~/.pgpass"
echo ""
echo "# Initialize schemas"
echo "PGPASSWORD=bench_pass psql -h localhost -U bench_user -d bench_db -f schema/pg_queue_basic.sql"
echo "bash schema/init_valkey.sh"
echo "PGPASSWORD=bench_pass pgbench -h localhost -U bench_user -d bench_db -i -s 10"
echo ""
echo "# Run benchmarks"
echo "export PGPASSWORD=bench_pass"
echo "./orchestration/run_valkey_tests.sh"
echo ""
echo "==================================================="
echo ""

# Analysis
echo "Step 3: Analyze results (on any machine with both results)"
echo ""
echo "pip3 install pandas matplotlib seaborn numpy"
echo ""
echo "cd analysis/"
echo "python3 analyze.py --pg-results ../results/vm1_pg --valkey-results ../results/vm2_valkey"
echo "python3 generate_graphs.py --input ../results/analysis/summary.csv"
echo ""
echo "==================================================="
echo ""
echo "For detailed instructions, see README.md"
